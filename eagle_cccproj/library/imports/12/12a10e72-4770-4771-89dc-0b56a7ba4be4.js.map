{"version":3,"sources":["assets/Writing/Script/WritingDot.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import WritingRightStar from './WritingRightStar';\nimport WritingSmallDot from './WritingSmallDot';\n\nconst { ccclass, property } = cc._decorator;\n\nconst MAIN_DOT_SHOWN_DURATION = 0.2;\nconst DOT_SHOWN_DURATION = [0.2, 0.4];\n\n/**\n * 笔画节点，管理每个引导点、画到后显示的星星及其周边点缀的小点的显示隐藏\n */\n@ccclass\nexport default class WritingDot extends cc.Component {\n    public static LAST_DOT_SHOWN_DURATION = DOT_SHOWN_DURATION[0] + DOT_SHOWN_DURATION[1];\n\n    @property(cc.Node)\n    mainDot: cc.Node = null;\n\n    @property(cc.Node)\n    starFinished: cc.Node = null;\n\n    mainDotShown: cc.AudioClip = null;\n\n    mainDotErased: cc.AudioClip = null;\n\n    starFinishedShown: cc.AudioClip = null;\n\n    /**\n     * 设置音效\n     * @param mainDotShown 黄色点出现音效\n     * @param mainDotErased 黄色点擦除音效\n     * @param starFinishedShown 彩色星星出现音效\n     * @param rightStarShown 白色星星出现音效\n     */\n    public setAudios(\n        mainDotShown: cc.AudioClip,\n        mainDotErased: cc.AudioClip,\n        starFinishedShown: cc.AudioClip,\n        rightStarShown: cc.AudioClip\n    ) {\n        this.mainDotShown = mainDotShown;\n        this.mainDotErased = mainDotErased;\n        this.starFinishedShown = starFinishedShown;\n        this.getRelativeDots().forEach((smallDot) => {\n            if (smallDot instanceof WritingRightStar) {\n                smallDot.setAudio(rightStarShown);\n            }\n        });\n    }\n\n    private _isTriggered = false;\n\n    public isTriggered() {\n        return this._isTriggered;\n    }\n\n    private relativeDots: WritingSmallDot[] = null;\n\n    /**\n     * 获取子节点中的正确星星与小点组件列表\n     */\n    public getRelativeDots() {\n        if (this.relativeDots === null) {\n            if (this.node.childrenCount > 0) {\n                this.relativeDots = this.node.children.map((dot) => {\n                    return dot.getComponent(WritingSmallDot);\n                });\n            } else {\n                this.relativeDots = [];\n            }\n        }\n\n        return this.relativeDots;\n    }\n\n    /**\n     * 擦除（画笔画到的时候调用）\n     */\n    public erase() {\n        if (this.mainDot) {\n            cc.audioEngine.play(this.mainDotErased, false, 1);\n        }\n\n        this._isTriggered = true;\n        this.hideAll();\n    }\n\n    /**\n     * 重置\n     */\n    public reset() {\n        this._isTriggered = false;\n        // 一开始先隐藏，等动画触发显示\n        this.hideAll();\n    }\n\n    /**\n     * 隐藏所有点\n     */\n    private hideAll() {\n        if (this.mainDot) {\n            this.mainDot.active = false;\n            this.mainDot.getComponent(cc.Sprite).enabled = true;\n        }\n\n        if (this.starFinished) {\n            this.starFinished.active = false;\n            this.starFinished.getComponent(cc.Sprite).enabled = true;\n        }\n\n        this.getRelativeDots().forEach((dot) => {\n            dot.reset();\n        });\n    }\n\n    /**\n     * 动画显示引导节点\n     */\n    public showGuide() {\n        this._isTriggered = false;\n        if (this.starFinished) {\n            this.starFinished.scale = 0;\n            this.starFinished.active = true;\n            this.starFinished.runAction(WritingRightStar.getStarShownAction());\n            cc.audioEngine.play(this.starFinishedShown, false, 1);\n        } else if (this.mainDot) {\n            this.mainDot.scale = 0;\n            this.mainDot.active = true;\n            this.mainDot.runAction(cc.scaleTo(MAIN_DOT_SHOWN_DURATION, 1, 1).easing(cc.easeBackOut()));\n            cc.audioEngine.play(this.mainDotShown, false, 1);\n        }\n    }\n\n    /**\n     * 点亮该节点，引导点隐藏，星星旋转出来，周边小点也同时渐显出来\n     */\n    public turnOn() {\n        // 引导点和结束点只能隐藏其图片，因为还有子节点星星要显示\n        if (this.mainDot) {\n            this.mainDot.getComponent(cc.Sprite).enabled = false;\n        } else if (this.starFinished) {\n            this.starFinished.getComponent(cc.Sprite).enabled = false;\n        }\n\n        // 剩余没点亮的星星也点亮\n        this.getRelativeDots()\n            .filter((dot) => !dot.isTriggered())\n            .forEach((dot) => {\n                dot.turnOn();\n            });\n\n        this._isTriggered = true;\n    }\n}\n"]}