{"version":3,"sources":["assets/Framwork/Utils/FitterWidthFirst.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAQ,IAAA,+BAAO,CAAmB;AAElC;;;GAGG;AAEH;IAA8C,oCAAY;IAD1D;QAAA,qEAyDC;QAvDW,YAAM,GAAc,IAAI,CAAC;QAEzB,eAAS,GAAW,IAAI,CAAC;QAEjC,gCAAgC;QACxB,kBAAY,GAAY,IAAI,CAAC;;IAkDzC,CAAC;IAhDG,iCAAM,GAAN;QACI,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC;QAC7C,OAAO,CAAC,KAAK,CAAC,kBAAM,IAAI,CAAC,SAAS,+CAAwB,CAAC,CAAC;QAE5D,IAAM,UAAU,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACrC,IAAI,CAAC,MAAM,GAAG,UAAU,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;QAEjD,OAAO;QACP,IAAI,CAAC,SAAS,EAAE,CAAC;QACjB,YAAY;QACZ,UAAU,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;IACvE,CAAC;IAED;;OAEG;IACK,oCAAS,GAAjB;QACI,IAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;QAC3B,IAAM,MAAM,GAAG,MAAM,CAAC,gBAAgB,CAAC;QACvC,IAAM,MAAM,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC;QACtC,qCAAqC;QACrC,IAAI,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,MAAM,GAAG,IAAI,EAAE;YACpE,IAAM,SAAS,GAAG,IAAI,CAAC,YAAY,KAAK,IAAI,IAAI,IAAI,CAAC,YAAY,CAAC;YAClE,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;YAE1B,uBAAuB;YACvB,IAAI,SAAS,IAAI,CAAC,MAAM,CAAC,QAAQ,KAAK,KAAK,IAAI,MAAM,CAAC,SAAS,KAAK,IAAI,CAAC,EAAE;gBACvE,MAAM,CAAC,QAAQ,GAAG,KAAK,CAAC;gBACxB,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC;gBACxB,OAAO,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;aAC/B;SACJ;aAAM;YACH,IAAM,SAAS,GAAG,IAAI,CAAC,YAAY,KAAK,IAAI,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC;YACnE,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;YAEzB,uBAAuB;YACvB,IAAI,SAAS,IAAI,CAAC,MAAM,CAAC,QAAQ,KAAK,IAAI,IAAI,MAAM,CAAC,SAAS,KAAK,KAAK,CAAC,EAAE;gBACvE,MAAM,CAAC,QAAQ,GAAG,IAAI,CAAC;gBACvB,MAAM,CAAC,SAAS,GAAG,KAAK,CAAC;gBACzB,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;aACzB;SACJ;IACL,CAAC;IAEO,mCAAQ,GAAhB;QACI,OAAO,CAAC,KAAK,CAAC,kBAAM,IAAI,CAAC,SAAS,iCAAU,CAAC,CAAC;QAC9C,IAAI,CAAC,SAAS,EAAE,CAAC;IACrB,CAAC;IAvDgB,gBAAgB;QADpC,OAAO;OACa,gBAAgB,CAwDpC;IAAD,uBAAC;CAxDD,AAwDC,CAxD6C,EAAE,CAAC,SAAS,GAwDzD;kBAxDoB,gBAAgB","file":"","sourceRoot":"/","sourcesContent":["const { ccclass } = cc._decorator;\n\n/**\n * 优先宽度适配组件，当屏幕比设计分辨率更宽时，适配高，否则适配宽。\n * 注意：如果有需要在代码中获取组件的位置的操作，不要在onLoad里去做，因为修改了适配方式后会重新布局，onLoad里取到的会是旧的。\n */\n@ccclass\nexport default class FitterWidthFirst extends cc.Component {\n    private canvas: cc.Canvas = null;\n\n    private sceneName: string = null;\n\n    // 是否按高适配，防止设置后导致canvas尺寸改变而重复设置\n    private isWidthFirst: boolean = null;\n\n    onLoad() {\n        this.sceneName = cc.director.getScene().name;\n        console.debug(`场景 ${this.sceneName} FitterHeightFirst组件加载`);\n\n        const canvasNode = cc.find('Canvas');\n        this.canvas = canvasNode.getComponent(cc.Canvas);\n\n        // 更新配置\n        this.updateFit();\n        // 监听窗口改变，重置\n        canvasNode.on(cc.Node.EventType.SIZE_CHANGED, this.resetFit, this);\n    }\n\n    /**\n     * 更新fit配置\n     */\n    private updateFit() {\n        const canvas = this.canvas;\n        const design = canvas.designResolution;\n        const device = cc.view.getFrameSize();\n        // 当相差超过0.01时，才算更宽，这样差别不是很大的屏幕，仍可以按宽走\n        if (device.width / device.height - design.width / design.height > 0.01) {\n            const needToSet = this.isWidthFirst === null || this.isWidthFirst;\n            this.isWidthFirst = false;\n\n            // 针对首次设置，若默认配置一样，也不用更新\n            if (needToSet && (canvas.fitWidth !== false || canvas.fitHeight !== true)) {\n                canvas.fitWidth = false;\n                canvas.fitHeight = true;\n                console.debug('比设计更宽，按高适配');\n            }\n        } else {\n            const needToSet = this.isWidthFirst === null || !this.isWidthFirst;\n            this.isWidthFirst = true;\n\n            // 针对首次设置，若默认配置一样，也不用更新\n            if (needToSet && (canvas.fitWidth !== true || canvas.fitHeight !== false)) {\n                canvas.fitWidth = true;\n                canvas.fitHeight = false;\n                console.debug('按宽适配');\n            }\n        }\n    }\n\n    private resetFit() {\n        console.debug(`场景 ${this.sceneName} 重新计算fit`);\n        this.updateFit();\n    }\n}\n"]}